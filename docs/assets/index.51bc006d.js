import{d as p,P as M,c as d,a as i,n as _,w as h,F as y,r as g,o as l,t as m,b as $,e as k,f as D,g as F,h as w,l as O,i as v,j as S}from"./vendor.b9fd36da.js";import"buffer/";const x=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}};x();var f=(e,t)=>{const s=e.__vccOpts||e;for(const[o,a]of t)s[o]=a;return s};const N=p({name:"Upload",components:{},emits:["minutesData","chatsData"],data(){return{errors:[],isFileOnDrop:!1}},methods:{openFileDialog(){this.$refs.csvFilesInput.click()},onInputChange(e){var s;const t=(s=e.target)==null?void 0:s.files;t&&this.handleFiles(t)},onFileDrop(e){this.isFileOnDrop=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&this.handleFiles(e.dataTransfer.files)},handleFiles(e){for(const t of Array.from(e))t.name.endsWith("minutes_watched.csv")?this.parseFile(t,"minutesData"):t.name.endsWith("chats_cheers_sub_notifications.csv")&&this.parseFile(t,"chatsData")},parseFile(e,t){const s=this;M.parse(e,{worker:!0,header:!0,skipEmptyLines:!0,complete:o=>{t==="chatsData"?s.$emit(t,o.data.filter(a=>a.event_type==="chat")):s.$emit(t,o.data)}})}}}),R={class:"flex flex-col"},P=$(" Drop your CSVs or "),W=i("span",{class:"underline"},"click",-1),j=$(" here to start. "),T=[P,W,j],q={class:"text-red-700"};function A(e,t,s,o,a,n){return l(),d("div",R,[i("input",{ref:"csvFilesInput",class:"hidden",name:"csvFiles",type:"file",onChange:t[0]||(t[0]=(...r)=>e.onInputChange&&e.onInputChange(...r)),multiple:""},null,544),i("div",{class:_(["py-16 mt-8 text-center bg-tertiary text-primary cursor-pointer",{"bg-indigo-100":e.isFileOnDrop,"":!e.isFileOnDrop}]),onDrop:t[1]||(t[1]=h((...r)=>e.onFileDrop&&e.onFileDrop(...r),["prevent","stop"])),onDragenter:t[2]||(t[2]=h(r=>e.isFileOnDrop=!0,["prevent","stop"])),onDragstart:t[3]||(t[3]=h(r=>e.isFileOnDrop=!0,["prevent","stop"])),onDragover:t[4]||(t[4]=h(r=>e.isFileOnDrop=!0,["prevent","stop"])),onDragleave:t[5]||(t[5]=h(r=>e.isFileOnDrop=!1,["prevent","stop"])),onDragend:t[6]||(t[6]=h(r=>e.isFileOnDrop=!1,["prevent","stop"])),onDrag:t[7]||(t[7]=h(()=>{},["prevent","stop"])),onClick:t[8]||(t[8]=(...r)=>e.openFileDialog&&e.openFileDialog(...r))},T,34),(l(!0),d(y,null,g(e.errors,r=>(l(),d("p",q,m(r),1))),256))])}var B=f(N,[["render",A]]);const I=p({name:"Presentation",components:{}}),Y=k('<h1 class="text-5xl my-4 font-bold text-primary text-center">Twitch Recap</h1><div><dl class="container mx-auto"><dt class="font-bold">What is Twitch Recap?</dt><dd>Twitch Recap shows you a lot of data from your viewing habits.</dd><dt class="font-bold">How does this works?</dt><dd><p>You can ask Twitch about your data <a class="underline text-secondary" target="_blank" href="https://app.onetrust.com/app/#/webform/ee57cd1d-b315-4b29-90cd-4def381b86c9">here</a>. <span class="italic">(<a class="underline text-secondary" target="_blank" href="https://www.twitch.tv/p/en/legal/privacy-choices/">source</a>)</span></p><p>Once you have your data, just drag and drop the CSV files in the box below.</p></dd><dt class="font-bold">But I don&#39;t want to share my data with you...</dt><dd>I wouldn&#39;t either. That&#39;s why everything is computed in your own browser! None of your data is sent anywhere.</dd></dl></div>',2);function L(e,t,s,o,a,n){return Y}var V=f(I,[["render",L]]);const U=p({name:"MinutesWatchedRecap",components:{},props:{year:{type:Number,required:!0},minutesData:{type:Array,required:!1}},computed:{totalMinutesByStreamer(){if(this.minutesData===void 0)return[];const e={},t=this.year.toString();for(const s of this.minutesData)s.day.startsWith(t)&&(s.channel_name in e||(e[s.channel_name]=0),e[s.channel_name]+=parseInt(s.context));return Object.entries(e).sort(([,s],[,o])=>o-s)}},methods:{formatMinutes(e){const t=Math.floor(e/60);return e=e%60,t>0?`${t}h${e.toString().padStart(2,"0")}m`:`${e}m`}}}),E=i("h2",{class:"text-2xl bold text-tertiary"},"Your top 10 favorite streamers",-1),z={class:"text-l font-bold"};function H(e,t,s,o,a,n){return l(),d("div",null,[E,i("ul",null,[(l(!0),d(y,null,g(e.totalMinutesByStreamer.slice(0,10),([r,u],b)=>(l(),d("li",{key:r,class:_(["flex justify-between border-b border-dashed mt-1",{"text-3xl":b===0,"text-2xl":b===1,"text-xl":b===2}])},[i("span",z,m(r),1),i("span",null,m(e.formatMinutes(u)),1)],2))),128))])])}var K=f(U,[["render",H]]);const G=p({name:"ChatMessagesRecap",components:{},props:{year:{type:Number,required:!0},chatsData:{type:Array,required:!1}},computed:{messagesSentByStreamer(){if(this.chatsData===void 0)return[];const e={},t=this.year.toString();for(const s of this.chatsData)s.day.startsWith(t)&&(s.channel in e||(e[s.channel]=0),e[s.channel]+=s.context.split("; ").length);return Object.entries(e).sort(([,s],[,o])=>o-s)},totalMessagesSent(){return this.messagesSentByStreamer.reduce((e,[,t])=>e+t,0)}},methods:{formatNumber(e){return new Intl.NumberFormat().format(e)}}}),J=i("h2",{class:"text-2xl bold text-tertiary"},"Your chat messages",-1),Q={class:"text-xl"},X={class:"font-bold"},Z=$(" messages sent overall, including:"),ee={class:"text-l font-bold"},te=$(" messages sent on "),ae={class:"text-l font-bold"},se=$(" channel.");function re(e,t,s,o,a,n){return l(),d("div",null,[J,i("div",Q,[i("span",X,m(e.formatNumber(e.totalMessagesSent)),1),Z]),i("ul",null,[(l(!0),d(y,null,g(e.messagesSentByStreamer.slice(0,5),([r,u])=>(l(),d("li",{key:r,class:"text-right"},[i("span",ee,m(e.formatNumber(u)),1),te,i("span",ae,m(r),1),se]))),128))])])}var ne=f(G,[["render",re]]);const oe=p({name:"Recap",components:{MinutesWatchedRecap:K,ChatMessagesRecap:ne},props:{year:{type:Number,required:!0},minutesData:{type:Array,required:!1},chatsData:{type:Array,required:!1}},computed:{},methods:{}}),ie={class:"flex justify-around"};function le(e,t,s,o,a,n){const r=D("MinutesWatchedRecap"),u=D("ChatMessagesRecap");return l(),d("div",null,[i("div",ie,[e.minutesData?(l(),F(r,{key:0,year:e.year,minutesData:e.minutesData},null,8,["year","minutesData"])):w("",!0),e.chatsData?(l(),F(u,{key:1,year:e.year,chatsData:e.chatsData},null,8,["year","chatsData"])):w("",!0)])])}var de=f(oe,[["render",le]]);const ue=p({name:"Charts",components:{},props:{year:{type:Number,required:!0},minutesData:{type:Array,required:!1},chatsData:{type:Array,required:!1}},mounted(){this.updateMinutesPlots()},watch:{year(){this.updateMinutesPlots()},minutesData(){this.updateMinutesPlots()}},methods:{updateMinutesPlots(){if(this.minutesData===void 0)return;const e={},t=this.year.toString();for(const a of this.minutesData)a.day.startsWith(t)&&(a.channel_name in e||(e[a.channel_name]={}),a.day in e[a.channel_name]||(e[a.channel_name][a.day]=0),e[a.channel_name][a.day]+=parseInt(a.context));const s=Object.entries(e).map(([a,n])=>({x:Object.keys(n),y:Object.values(n),hovertemplate:"<b>%{y}</b> minutes<br><b>%{x}</b>",customdata:{total:Object.values(n).reduce((r,u)=>r+u,0)},name:a,type:"bar"})).sort((a,n)=>a.customdata.total-n.customdata.total).slice(-10),o={title:"Top 10 Streamer Watched Time",xaxis:{title:"Day",rangeslider:!0},yaxis:{title:"Time Watched"},barmode:"stack",paper_bgcolor:"rgba(0,0,0,0)"};O.newPlot(this.$refs.minutesChart,s,o,{displayModeBar:!1})}}}),ce={ref:"minutesChart"};function pe(e,t,s,o,a,n){return l(),d("div",null,[i("div",ce,null,512)])}var he=f(ue,[["render",pe]]);const me=p({name:"App",components:{Presentation:V,Upload:B,Recap:de,Charts:he},data(){return{minutesData:void 0,chatsData:void 0,currentYear:2021}},computed:{years(){return[2021,2020,2019,2018,2017,2016]},hasData(){return!!this.minutesData||!!this.chatsData}}}),fe={class:"bg-secondary mx-auto pt-4 pb-8"},ye={class:"flex justify-center"},De=["onClick"];function be(e,t,s,o,a,n){const r=D("Presentation"),u=D("Upload"),b=D("Recap"),C=D("Charts");return l(),d(y,null,[v(r),v(u,{onMinutesData:t[0]||(t[0]=c=>e.minutesData=c),onChatsData:t[1]||(t[1]=c=>e.chatsData=c)}),e.hasData?(l(),d(y,{key:0},[i("div",fe,[i("div",null,[i("ul",ye,[(l(!0),d(y,null,g(e.years,c=>(l(),d("li",{key:c,class:_(["text-xl cursor-pointer",{"text-tertiary border-tertiary border-b-2 font-bold px-2 mx-0":e.currentYear===c,"text-white border-white border-b px-1 mx-1":e.currentYear!==c}]),onClick:ge=>e.currentYear=c},m(c),11,De))),128))])]),v(b,{year:e.currentYear,minutesData:e.minutesData,chatsData:e.chatsData},null,8,["year","minutesData","chatsData"])]),v(C,{year:e.currentYear,minutesData:e.minutesData,chatsData:e.chatsData},null,8,["year","minutesData","chatsData"])],64)):w("",!0)],64)}var $e=f(me,[["render",be]]);S($e).mount("#app");
